<!DOCTYPE html>
<!-- Microdata markup added by Google Structured Data Markup Helper. -->
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://ogp.me/ns/fb#">
<head>
    <meta charset="utf-8" />
    <title>What are the Azure Databricks best practices?</title>
    <meta name="title" content="What are the Azure Databricks best practices?" />
    <meta name="theme-color" content="#c00000">
    <meta name="description" content="Improve job speed and save storage with our 18 Azure Databricks best practices." />
    <meta name="keywords" content="azure databricks best practices and guidelines, azure databricks best practices, Power BI governance, best practices for azure databricks, best practices azure databricks" />
    <meta name="ROBOTS" content="FOLLOW,INDEX" />
    <!-- Open Graph data -->
    <meta name="og:title" property="og:title" content="What are the Power BI best practices for Designing & Reporting?" />
    <meta name="og:description" property="og:description" content="Improve job speed and save storage with our 18 Azure Databricks best practices." />
    <meta property="og:image" name="og:image" content="/img/Banners/BPG007-main.jpg" />
    <meta property="og:image:width" content="450" />
    <meta property="og:image:height" content="298" />
    <!-- End Open Graph data -->
    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@maqsoftware" />
    <meta name="twitter:title" content="What are the Azure Databricks best practices?" />
    <meta name="twitter:description" content="Improve job speed and save storage with our 18 Azure Databricks best practices." />
    <meta name="twitter:image" content="/img/Banners/BPG007-main.jpg" />
    <!-- End Twitter Card data -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="fragment" content="!">
    <!--[if IE]><meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'><![endif]-->
    <!-- Favicone Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico">
    <link rel="icon" type="image/png" href="/img/favicon.ico">
    <link rel="apple-touch-icon" href="/img/favicon.ico">
    <!-- CSS -->
    <link href="/css/style.css?v=20210603" rel="stylesheet" type="text/css" />
    <link href="/css/bootstrap.min.css?v=20170822" rel="stylesheet" type="text/css" />
    <link href="/css/font-awesome.css?v=20170822" rel="stylesheet" type="text/css" />
    <link href="/css/ionicons.css?v=20170822" rel="stylesheet" type="text/css" />
    <link href="/css/plugin/sidebar-menu.css?v=20170822" rel="stylesheet" type="text/css" />
    <link href="/css/plugin/animate.css?v=20170822" rel="stylesheet" type="text/css" />
    <link href="/css/jquery-ui.css?v=20170822" rel="stylesheet" type="text/css" />
    <link href="/css/plugin/owl.carousel.2.0.0-beta.3.min.css" rel="stylesheet" />
</head>

<body>
    <!--Facebook Java SDK-->
    <div id="fb-root"></div>
    <script>
(function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.11';
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>
    <!-- Preloader -->
    <section id="preloader">
        <div class="loader" id="loader">
            <div class="loader-img"></div>
        </div>
    </section>
    <!-- End Preloader -->
    <!-- Site Wraper -->
    <div class="wrapper">
        <!-- Header -->
        <header id="header" class="header">
        </header>
        <!-- End Header -->
        <!-- Intro Section -->
        <section class="inner-intro dark-bg bg-image parallax parallax-background1 aboutposter" data-background-img="/img/Banners/General_Website_Banner_THIN.png">
        </section>
        <!-- End Intro Section -->
        <!-- Content Section -->
        <section id="about" class="wow fadeIn pt-90 pb-25">
            <div class="container">
                <div class="row text-left">
                    <div class="col-md-10 offset-md-1">
                        <h1>Azure Databricks Best Practice Guide</h1>
                        <p><span><i class="ion ion-calendar"></i> Last Updated: August 16, 2021 </span><span><i class="ion ion-clock"></i> 10 Minutes to Read</span><p>
                        <!-- Social Media -->
                        <!-- Facebook Share -->
                        <div class="fb-share-button" data-href="https://maqsoftware.com//expertise/cloudtransformation/azure-databricks-best-practices" data-layout="button_count" data-size="small" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmaqsoftware.com%2Fexpertise%2Fcloudtransformation%2Fazure-databricks-best-practices&amp;src=sdkpreparse">Share</a></div>
                        <!-- End Facebook Share -->
                        <!-- Twitter Share -->
                        <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-text="Azure Databricks Best Practices | MAQ Software" data-show-count="false">Tweet</a>
                        <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                        <!-- End Twitter Share -->
                        <!-- LinkedIn Share -->
                        <span class="linkedin-share-button">
                            <script src="//platform.linkedin.com/in.js" type="text/javascript"> lang: en_US</script>
                            <script type="IN/Share" data-counter="right">
                            </script>
                        </span>
                        <!-- End LinkedIn Share -->
                        <!-- End Social Media -->
                        <br><br>
                        <p class="lead">Azure Databricks (ADB) has the power to process terabytes of data, while simultaneously running heavy data science workloads. Over time, as data input and workloads increase, job performance decreases. As an ADB developer, optimizing your platform enables you to work faster and save hours of effort for you and your team. Below are the 18 best practices you need to optimize your ADB environment.</p>
                    </div>
                </div>
            </div>
        </section>
        <section class="pb-40">
            <div class="container">
                <div class="row ptb-15">

                    <div class="col-md-10 offset-md-1 col-sm-10 offset-sm-1">
                        <p class="pt-5px">

                        </p>

                        <ol class="pb-10">
                            <li class="h4header">
                                Delete temporary tables after notebook execution
                                    <p>Delete temporary tables that were created as intermediate tables during notebook execution. Deleting tables saves storage, especially if the notebook is scheduled daily.</p>
                            </li>
                            <li class="h4header">
                                Use <code>dbutils.fs.rm()</code> to permanently delete temporary table metadata 
                                    <p>ADB clusters store table metadata, even if you use drop statements to delete. Before creating temporary tables, use <code>dbutils.fs.rm()</code> to permanently delete metadata. If you don’t use this statement, an error message will appear stating that the table already exists. To avoid this error in daily refreshes, you must use <code>dbutils.fs.rm()</code>.</p>
                            </li>
                            <li class="h4header">
                                Use <i>Lower()</i> or <i>Upper()</i> when comparing strings to avoid losing data
                                    <p>ADB can't compare strings with different casing. To avoid losing data, use case conversion statements <i>Lower()</i> or <i>Upper()</i>. Example:</p>    
                                        <code>
                                            SELECT 'MAQSoftware' = 'maqsoftware' AS WithOutLowerOrUpper<br />
                                            ,LOWER('MAQSoftware') = 'maqsoftware' AS WithLower<br />
                                            ,UPPER('MAQSoftware') = 'MAQSOFTWARE' AS WithUpper
                                        </code>
                            </li>
                            <li class="h4header">
                                Use Scala for data processing
                                    <p>ADB’s data processing is based on Apache Spark, which is written in Scala. As a result, Scala performs better than SQL in ADB. Note: Python should still be used for machine learning functions in ADB.</p>
                            </li>
                            <li class="h4header">
                                Use custom functions to simplify complex calculations
                                    <p>If your calculation requires multiple steps, you can save time and by creating a one-step custom function. ADB offers a variety of built in SQL functions, however to create custom functions, known as user-defined functions (UDF), use Scala. Once you have a custom function, you can call it every time you need to perform that specific calculation.</p>
                            </li>
                            <li class="h4header">
                                Use Delta tables for DML commands
                                    <p>In ADB, Hive tables do not support UPDATE and MERGE statements or NOT NULL and CHECK constraints. Delta tables do support these commands, however running large amounts of data on Delta tables decreases query performance. So not to decrease performance, store table versions. </p>
                            </li>
                            <li class="h4header">
                                Use views when creating intermediate tables
                                    <p>If you need to create intermediate tables, use views to minimize storage usage and save costs. Views are session-oriented and will automatically remove tables from storage after query execution. For optimal query performance, do not use joins or subqueries in views.</p>
                            </li>
                            <li class="h4header">
                                Enable adaptive query execution (AQE)
                                    <p>AQE improves large query performance. By default, AQE is disabled in ADB. To enable it, use: <code>set spark.sql.adaptive.enabled = true;</code></p>
                            </li>
                            <li class="h4header">
                                Partition by columns
                                    <p>Delta tables in ADB support partitioning, which enhances performance. You can partition by a column if you expect data in that partition to be at least 1 GB. If column cardinality is high, do not use that column for partitioning. For example, if you partition by user ID and there are 1M distinct user IDs, partitioning would increase table load time. Syntax example:</p>
                                        <code>CREATE TABLE events (<br />
                                            DATE DATE<br />
                                            ,eventId STRING<br />
                                            ,eventType STRING<br />
                                            ,data STRING<br />
                                            ) USING delta PARTITIONED BY (DATE)
                                        </code>
                            </li>
                            <li class="h4header">
                                Use key vault credentials when creating mount points
                                    <p>When creating mount points to Azure Data Lake Storage (ADLS), use a key vault client ID and client secret to enhance security.</p>
                            </li>
                            <li class="h4header">
                                Query directly on parquet files from ADLS
                                    <p>If you need to use the data from parquet files, do not extract into ADB in intermediate table format. Instead, directly query on the parquet file to save time and storage. Example:</p>
                                    <code>SELECT ColumnName FROM parquet.`Location of the file`</code>
                            </li>
                            <li class="h4header">
                                Specify distribution when publishing data to Azure Data Warehouse (ADW)
                                    <p>Use hash distribution for fact tables or large tables, round robin for dimensional tables, replicated for small dimensional tables. Example: </p>
                                        <code>df.write \<br />
                                            .format("com.databricks.spark.sqldw") \<br />
                                            .option("url", "jdbc:sqlserver://&lt;the-rest-of-the-connection-string&gt;<br />
                                                ") \<br />
                                                .option("forwardSparkAzureStorageCredentials", "true") \<br />
                                                .option("dbTable", "my_table_in_dw_copy") \<br />
                                                .option("tableOptions", "table_options") \<br />
                                                .save()<br />
                                        </code>
                                    <br>
                                    <p>For more information, check out: <a href="https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/sql-data-warehouse-tables-distribute" target="blank" class="underlined">Distributed tables design guidance - Azure Synapse Analytics</a></p>
                            </li>
                            <li class="h4header">
                                Customize cluster termination time
                                    <p>Terminating inactive clusters saves costs. ADB automatically terminates clusters based on a default down time. As different projects have different needs, it’s important to customize the down time to avoid premature or delayed termination. For example: set a longer down time for development environments, as work is continuous.</p>
                            </li>
                            <li class="h4header">
                                Enable cluster autoscaling
                                    <p>ADB offers cluster autoscaling, which is disabled by default. Enable this feature to enhance job performance. Instead of providing a fixed number of worker nodes during cluster creation, you should provide a minimum and maximum. ADB then automatically reallocates the worker nodes based on job characteristics.</p>
                            </li>
                            <li class="h4header">
                                Use Azure Data Factory (ADF) to run ADB notebook jobs
                                    <p>If you run numerous notebooks daily, the ADB job scheduler will not be efficient. The ADB job scheduler cannot set notebook dependency, so you would have to store all notebooks in one master, which is difficult to debug. Instead, schedule jobs through Azure Data Factory, which enables you to set dependency and easily debug if anything fails.</p>
                            </li>
                            <li class="h4header">
                                Use the retry feature in ADF when scheduling jobs
                                    <p>Processing notebooks in ADB through ADF can overload the cluster, causing notebooks to fail. If failure occurs, the entire job should not stop. To continue work from the point of failure, set ADF to retry two to three times with five-minute intervals. As a result, the processing should continue from the set time, saving you time and effort.</p>
                            </li>
                            <li class="h4header">
                                Implement failure checkpoints while publishing data
                                    <p>With ADB, you can dump data into multiple resources like ADW or ADLS. Publishing numerous tables to another resource takes time. If publishing fails, do not restart the entire process. Implement checkpoints, so that you can restart from the point of failure.</p>
                            </li>
                            <li class="h4header">
                                Consider upgrading to ADB Premium
                                    <p>Your business’s data has never been more valuable. Additional security is a worthwhile investment. ADB Premium includes 5-level access control. For more features, check out: <a href="https://azure.microsoft.com/en-us/pricing/details/databricks/" target="blank" class="underlined">Premium vs. Standard</a>.</p>
                            </li>
                        </ol>
                    </div>
                </div>
                <div class="row ptb-15">
                    <div class="col-md-10 offset-md-1 col-sm-10 offset-sm-1">
                        <h3>References</h3>
                        <ul class="defaultBody">
                            <li><a href="https://docs.microsoft.com/en-us/azure/databricks/delta/">Delta tables</a> – Microsoft Corporation, last updated June 11, 2021</li>
                            <li><a href="https://docs.microsoft.com/en-us/azure/databricks/spark/latest/spark-sql/language-manual/sql-ref-datatypes#sql">Datatypes in ADB</a> – Microsoft Corporation, last updated June 29, 2021</li>
                            <li><a href="https://docs.microsoft.com/en-us/azure/databricks/scenarios/store-secrets-azure-key-vault">Key Vault usage</a> – Microsoft Corporation, last updated July 19, 2019</li>
                            <li><a href="https://docs.microsoft.com/en-us/azure/databricks/clusters/configure#cluster-size-and-autoscaling">Configure Clusters (Autoscaling)</a> – Microsoft Corporation, last updated August 9, 2021</li>
                            <li><a href="https://databricks.com/blog/2020/05/29/adaptive-query-execution-speeding-up-spark-sql-at-runtime.html">Features in AQE</a> – Databricks, last updated May 29, 2020</li>
                            <li><a href="https://docs.databricks.com/clusters/clusters-manage.html#automatic-termination-1">Automatic termination</a> – Databricks, last updated August 10, 2021</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        <!-- END CONTENT ---------------------------------------------------------------------------->
        <!-- FOOTER -->
        <footer class="footer pt-60" id="footer">
        </footer>
        <!-- END FOOTER -->
        <!-- Scroll Top -->
        <a class="scroll-top">
            <i class="fa fa-angle-double-up"></i>
        </a>
        <!-- End Scroll Top -->
    </div>
    <!-- Site Wraper End -->
    <!-- JS -->
    <!-- Load app main script -->
    <script src="/js/plugin/tether.min.js?v=20170822" type="text/javascript"></script>
    <script src="/js/jquery-1.11.2.min.js?v=20170822" type="text/javascript"></script>
    <script src="/js/plugin/jquery.easing.js?v=20170822" type="text/javascript"></script>
    <script src="/js/jquery-ui.min.js?v=20170822" type="text/javascript"></script>
    <script src="/js/bootstrap.min.js?v=20170822" type="text/javascript"></script>
    <script src="/js/plugin/jquery.flexslider.js?v=20170822" type="text/javascript"></script>
    <script src="/js/plugin/jquery.fitvids.js?v=20170822" type="text/javascript"></script>
    <script src="/js/plugin/jquery.viewportchecker.js?v=20170822" type="text/javascript"></script>
    <script src="/js/plugin/jquery.stellar.min.js?v=20170822" type="text/javascript"></script>
    <script src="/js/plugin/wow.min.js?v=20170822" type="text/javascript"></script>
    <script src="/js/plugin/jquery.colorbox-min.js?v=20170822" type="text/javascript"></script>
    <script src="/js/plugin/owl.carousel.2.0.0-beta.3.min.js"></script>
    <script src="/js/plugin/isotope.pkgd.min.js?v=20170822" type="text/javascript"></script>
    <script src="/js/plugin/masonry.pkgd.min.js?v=20170822" type="text/javascript"></script>
    <script src="/js/plugin/imagesloaded.pkgd.min.js?v=20170822" type="text/javascript"></script>
    <script src="/js/plugin/jquery.fs.tipper.min.js?v=20170822" type="text/javascript"></script>
    <script src="/js/plugin/mediaelement-and-player.min.js?v=20170822"></script>
    <script src="/js/plugin/sidebar-menu.js?v=20170822" type="text/javascript"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="/js/theme.js?v=20170828.6" type="text/javascript"></script>
    <script src="/js/navigation.js?v=20170822" type="text/javascript"></script>
    <script src="/js/contact.js?v=20170828.2" type="text/javascript"></script>
    <script src="/js/common.js?v=20170828.1" type="text/javascript"></script>
    <script src="/js/home.js?v=20190717" type="text/javascript"></script>
    <script src="/js/news.js?v=20190717" type="text/javascript"></script>
    <script src="/js/careers.js?v=20190717"></script>
    <script>
        $("#header").load("/header");
        $("#footer").load("/footer");
    </script>
    <script type="application/ld+json">
        { "@context" : "http://schema.org",
        "@type" : "Organization",
        "name" : "MAQ Software",
        "image" : "https://maqsoftware.com/img/MAQSoftware.png",
        "address" : {
        "@type": "PostalAddress",
        "addressLocality": "Redmond",
        "addressRegion": "WA ",
        "postalCode": "98052",
        "streetAddress": "2027 152nd Avenue NE" },
        "url" : "https://maqsoftware.com/",
        "logo" : "https://maqsoftware.com/img/MAQSoftware.png",
        "email":"sales@MAQSoftware.com",
        "telephone":"+1-425-526-5399",
        "sameAs" : [
        "https://www.linkedin.com/company/maq-software",
        "https://twitter.com/MAQSoftware",
        "https://youtube.com/maqsoftware",
        "https://www.facebook.com/maqsoftware",
        "https://www.instagram.com/maqsoftware",
        "https://plus.google.com/104615735701576694043"]
        }
    </script>
    <!-- Google Analytics -->
    <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-7928102-1', 'auto');
        ga('send', 'pageview');

    </script>
    <!-- End Google Analytics -->
</body>

</html>

<script>
    loadPlugins();
</script>
